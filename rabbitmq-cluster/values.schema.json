{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RabbitMQ Cluster Values Schema",
  "type": "object",
  "properties": {
    "nameOverride": {
      "type": "string",
      "description": "String to partially override the release name"
    },
    "fullnameOverride": {
      "type": "string",
      "description": "String to fully override deployment.fullname template"
    },
    "monitoring": {
      "type": "boolean",
      "description": "Enable PodMonitor for Prometheus metrics scraping"
    },
    "dashboard": {
      "type": "boolean",
      "description": "Add a Grafana dashboard ConfigMap for RabbitMQ"
    },
    "serviceMonitor": {
      "type": "object",
      "description": "Prometheus ServiceMonitor configuration",
      "properties": {
        "create": { "type": "boolean" }
      },
      "required": ["create"]
    },
    "serviceAccount": {
      "type": "object",
      "description": "Service account configuration for RabbitMQ pods",
      "properties": {
        "create": { "type": "boolean" },
        "annotations": {
          "type": "object",
          "additionalProperties": { "type": "string" }
        },
        "name": { "type": "string" }
      },
      "required": ["create"]
    },
    "imagePullSecrets": {
      "type": "array",
      "description": "List of Kubernetes secrets used to pull images from private registries",
      "items": { "type": "string" }
    },
    "podAnnotations": {
      "type": "object",
      "description": "Annotations for RabbitMQ pods",
      "additionalProperties": { "type": "string" }
    },
    "podSecurityContext": {
      "type": "object",
      "description": "Security context for RabbitMQ pods",
      "properties": {
        "runAsNonRoot": { "type": "boolean" },
        "runAsUser": { "type": "integer" },
        "runAsGroup": { "type": "integer" },
        "seccompProfile": {
          "type": "object",
          "properties": {
            "type": { "type": "string" }
          },
          "required": ["type"]
        }
      }
    },
    "containerSecurityContext": {
      "type": "object",
      "description": "Security context for RabbitMQ containers",
      "properties": {
        "allowPrivilegeEscalation": { "type": "boolean" },
        "capabilities": {
          "type": "object",
          "properties": {
            "drop": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        }
      }
    },
    "resources": {
      "type": "object",
      "description": "Container resource requests and limits",
      "properties": {
        "limits": {
          "type": "object",
          "properties": {
            "cpu": { "type": "string" },
            "memory": { "type": "string" }
          },
          "required": ["cpu", "memory"]
        },
        "requests": {
          "type": "object",
          "properties": {
            "cpu": { "type": "string" },
            "memory": { "type": "string" }
          },
          "required": ["cpu", "memory"]
        }
      },
      "required": ["limits", "requests"]
    },
    "nodeSelector": {
      "type": "object",
      "description": "Node labels for pod assignment",
      "additionalProperties": { "type": "string" }
    },
    "tolerations": {
      "type": "array",
      "description": "Tolerations for pod assignment",
      "items": { "type": "object" }
    },
    "affinity": {
      "type": "object",
      "description": "Affinity rules for pod scheduling"
    },
    "delayStartSeconds": {
      "type": "integer",
      "minimum": 0,
      "description": "Delay time in seconds before RabbitMQ container startup (to ensure DNS propagation)"
    },
    "persistence": {
      "type": "object",
      "description": "Persistent storage configuration for RabbitMQ data",
      "properties": {
        "storage": { "type": "string", "minLength": 1 },
        "storageClassName": { "type": ["string", "null"] }
      },
      "required": ["storage"]
    },
    "replicaCount": {
      "type": "integer",
      "enum": [1, 3, 5],
      "description": "Number of RabbitMQ replicas (recommended odd number for quorum)"
    },
    "skipPostDeploySteps": {
      "type": "boolean",
      "description": "Skip RabbitMQ post-deploy queue rebalance steps"
    },
    "terminationGracePeriodSeconds": {
      "type": "integer",
      "minimum": 0,
      "description": "Grace period for pod termination (default 604800 seconds)"
    },
    "plugins": {
      "type": "array",
      "description": "RabbitMQ plugins to enable (e.g. rabbitmq_federation, rabbitmq_mqtt)",
      "items": { "type": "string" }
    },
    "queues": {
      "type": "array",
      "description": "List of RabbitMQ queues to configure",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string", "minLength": 1 },
          "spec": {
            "type": "object",
            "properties": {
              "durable": { "type": "boolean" },
              "arguments": {
                "type": "object",
                "additionalProperties": {
                  "type": ["string", "integer", "boolean"]
                }
              }
            }
          }
        },
        "required": ["name"]
      }
    },
    "policies": {
      "type": "array",
      "description": "RabbitMQ policy definitions",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string", "minLength": 1 },
          "pattern": { "type": "string" },
          "definition": {
            "type": "object",
            "additionalProperties": { "type": ["string", "integer", "boolean"] }
          },
          "spec": {
            "type": "object",
            "properties": {
              "applyTo": {
                "type": "string",
                "enum": [
                  "queues",
                  "classic_queues",
                  "quorum_queues",
                  "streams",
                  "exchanges",
                  "all"
                ]
              },
              "priority": { "type": ["integer", "null"] },
              "vhost": { "type": ["string", "null"] }
            }
          }
        },
        "required": ["name"]
      }
    },
    "additionalConfig": {
      "type": "string",
      "description": "Additional entries for rabbitmq.conf"
    },
    "advancedConfig": {
      "type": "string",
      "description": "Additional entries for advanced.config"
    },
    "envConfig": {
      "type": "string",
      "description": "Additional entries for rabbitmq-env.conf"
    }
  },
  "required": ["replicaCount", "resources", "persistence", "serviceAccount"]
}
